<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ car.title }} - Hasanov Rentals LLC</title>
  <link rel="stylesheet" href="/static/css/style.css" />
</head>
<body>
  <!-- Header -->
  <header>
    <h1>Hasanov Rentals LLC</h1>
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/inventory/" class="active">Inventory</a></li>
        <li><a href="/insurance">Insurance</a></li>
        <li><a href="/terms">Terms</a></li>
        <li><a href="/contact">Contact Us</a></li>
      </ul>
      <div class="auth-buttons">
        {% if photo %}
          <a href="/profile">
            <img src="/static/images/avatars/{{ photo }}" alt="Аватар" style="width: 50px; height: 50px; border-radius: 50%;">
          </a>
        {% else %}
          <a href="/login" class="btn btn-outline">Login</a>
          <a href="/register" class="btn">Sign Up</a>
        {% endif %}
      </div>
    </nav>
  </header>

  <!-- Car Detail Header -->
  <section class="car-detail-header">
    <h1>{{ car.title }}</h1>
    <p>Experience the power of excellence</p>
  </section>

  <!-- Main Content -->
  <div class="car-detail-container">
    <div class="car-detail-content">
      <img src="/static/images/autos/{{ car.photo }}" alt="{{ car.title }}" class="car-detail-image" />

      <div class="car-detail-info">
        <h2>{{ car.title }}</h2>
        <p class="car-detail-price">${{ car.price }}/day</p>

        <div class="car-detail-description">
          <p>{{ car.description }}</p>
        </div>

        <div class="car-detail-specs">
          <h3>Performance Specifications</h3>
          <ul>
            <li><strong>Motors:</strong> {{ car_specs.engine }}</li>
            <li><strong>Horsepower:</strong> {{ car_specs.horsepower }}</li>
            <li><strong>Torque:</strong> {{ car_specs.torque }}</li>
            <li><strong>0–60 mph:</strong> {{ car_specs.mph }}</li>
            <li><strong>Top Speed:</strong> {{ car_specs.top_speed }}</li>
            <li><strong>Transmission:</strong> {{ car_specs.transmission }}</li>
            <li><strong>Drivetrain:</strong> {{ car_specs.drivetrain }}</li>
            <li><strong>Hybrid System:</strong> {{ car_specs.hybrid_system }}</li>
          </ul>
        </div>

        <div class="car-detail-specs">
          <h3>Technology Features</h3>
          <ul>
            <li><strong>Technology:</strong> {{ car_specs.technology }}</li>
            <li><strong>Audio:</strong> {{ car_specs.audio }}</li>
            <li><strong>Interior:</strong> {{ car_specs.interior }}</li>
            <li><strong>Lighting:</strong> {{ car_specs.lighting }}</li>
            <li><strong>Comfort:</strong> {{ car_specs.comfort }}</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Rental Form -->
    <div class="car-rental-form">
      <h3>Reserve This Vehicle</h3>
      <form id="rentalForm" method="get" action="/checkout">
        <input type="hidden" name="car_id" value="{{ car.id }}" />
        <div class="form-group">
          <label for="start-date">Rental Start Date</label>
          <input type="date" min="{{ current_date }}" id="start-date" name="start_time" required />
        </div>
        <div class="form-group">
          <label for="end-date">Rental End Date</label>
          <input type="date" min="{{ tomorrow_date }}" id="end-date" name="end_time" required />
        </div>
        <div class="price-summary" id="priceDisplay">
          Total Rental Price: $0
        </div>
        <button type="submit" class="btn">Reserve Now</button>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 Hasanov Rentals LLC. All rights reserved.</p>
  </footer>

  <!-- Price Calculator Script -->
  <script>
    const dailyRate = {{ car.price }};
    const startDateInput = document.getElementById('start-date');
    const endDateInput = document.getElementById('end-date');
    const priceDisplay = document.getElementById('priceDisplay');

    const today = new Date().toISOString().split('T')[0];
    startDateInput.min = today;
    endDateInput.value = "";
    endDateInput.min = "";

    function calculatePrice() {
      const startVal = startDateInput.value;
      const endVal = endDateInput.value;

      if (!startVal || !endVal) {
        priceDisplay.textContent = 'Total Rental Price: $0';
        return;
      }

      const start = new Date(startVal);
      const end = new Date(endVal);

      if (isNaN(start) || isNaN(end) || start > end) {
        priceDisplay.textContent = 'Total Rental Price: $0';
        return;
      }

      const diffTime = end.getTime() - start.getTime();
      const days = (start.getTime() === end.getTime()) ? 1 : Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      const total = days * dailyRate;
      priceDisplay.textContent = `Total Rental Price: $${total} (${days} days)`;
    }

    startDateInput.addEventListener('change', () => {
      const startVal = startDateInput.value;
      if (startVal) {
        const start = new Date(startVal);
        start.setDate(start.getDate() + 1);
        const yyyy = start.getFullYear();
        const mm = String(start.getMonth() + 1).padStart(2, '0');
        const dd = String(start.getDate()).padStart(2, '0');
        const minEndDate = `${yyyy}-${mm}-${dd}`;
        endDateInput.min = minEndDate;

        if (!endDateInput.value || endDateInput.value < minEndDate) {
          endDateInput.value = minEndDate;
        }
      } else {
        endDateInput.value = "";
        endDateInput.min = "";
      }
      calculatePrice();
    });

    endDateInput.addEventListener('change', calculatePrice);
    calculatePrice();
  </script>
</body>
</html>
